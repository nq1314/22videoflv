<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>学堂直播人群选择</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<meta name="screen-orientation" content="portrait">
		<meta name="x5-orientation" content="portrait">
		
		<meta name="apple-touch-fullscreen" content="YES" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta http-equiv="Expires" content="-1" />
		<meta http-equiv="pragram" content="no-cache" />
		
		<script>!function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window;t["default"]=i.flex=function(normal,e,t){var a=e||100,n=t||1,r=i.document,o=navigator.userAgent,d=o.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i),l=o.match(/U3\/((\d+|\.){5,})/i),c=l&&parseInt(l[1].split(".").join(""),10)>=80,p=navigator.appVersion.match(/(iphone|ipad|ipod)/gi),s=i.devicePixelRatio||1;p||d&&d[1]>534||c||(s=1);var u=normal?1:1/s,m=r.querySelector('meta[name="viewport"]');m||(m=r.createElement("meta"),m.setAttribute("name","viewport"),r.head.appendChild(m)),m.setAttribute("content","width=device-width,user-scalable=no,initial-scale="+u+",maximum-scale="+u+",minimum-scale="+u),r.documentElement.style.fontSize=normal?"50px": a/2*s*n+"px"},e.exports=t["default"]}]);  flex(false,100, 1);
				document.documentElement.style.fontSize = document.documentElement.clientWidth / 640*100 + 'px';
		</script>
		<!--移动端版本兼容 -->
		<script type="text/javascript">
		    var phoneWidth =  parseInt(window.screen.width);
		    var phoneScale = phoneWidth/640;
		    var ua = navigator.userAgent;
		    if (/Android (\d+\.\d+)/.test(ua)){
		        var version = parseFloat(RegExp.$1);
		        // andriod 2.3
		        if(version>2.3){
		            document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
		        // andriod 2.3以上
		        }else{
		            document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
		        }
		        // 其他系统
		    } else {
		        document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
		    }
		    //微信去掉下方刷新栏
		    if(RegExp("MicroMessenger").test(navigator.userAgent)){
		        document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
		            WeixinJSBridge.call('hideToolbar');
		        });
		    }
		</script>
		<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
		<link type="text/css" rel="stylesheet" href="style.css">
	</head>
	<body>
            <video id="video" width="100%" height="100%" webkit-playsinline="true" x5-playsinline=""
                            x5-video-player-type="h5" x5-video-player-fullscreen="" playsinline preload="auto"
                            poster="" src="" :playOrPause="playOrPause" x-webkit-airplay="allow"
                            x5-video-orientation="portrait" 
                            loop="loop" controls>
            </video>

		<script>
             $(function(){
             	console.log(window.navigator.userAgent,navigator)
             	 		//访问用户媒体设备的兼容方法
						function getUserMedia(constrains,success,error){
						    if(navigator.mediaDevices.getUserMedia){
						        //最新标准API
						        navigator.mediaDevices.getUserMedia(constrains).then(success).catch(error);
						    } else if (navigator.webkitGetUserMedia){
						        //webkit内核浏览器
						        navigator.webkitGetUserMedia(constrains).then(success).catch(error);
						    } else if (navigator.mozGetUserMedia){
						        //Firefox浏览器
						        navagator.mozGetUserMedia(constrains).then(success).catch(error);
						    } else if (navigator.getUserMedia){
						        //旧版API
						        navigator.getUserMedia(constrains).then(success).catch(error);
						    }else if(navigator.msGetUserMedia){
						    	navigator.getUserMedia(constrains).then(success).catch(error);
						    }
						}
						
						
						var video = document.getElementById("video");
						
						//成功的回调函数
						function success(stream){
							alert(stream)
						    //兼容webkit内核浏览器
						    var CompatibleURL = window.URL || window.webkitURL || window.mozURL || window.msURL; 
						    //将视频流设置为video元素的源
						    video.src = CompatibleURL.createObjectURL(stream)|| stream; 
						    //播放视频
							video.play();
							// var req = new XMLHttpRequest();
							// req.open("POST", "rtmp://127.0.0.1:1935/live");
							// req.send(data);
// 							$.ajax({
// 								//请求方式
// 								type : "POST",
// 								//请求的媒体类型
// 								contentType: "application/json;charset=UTF-8",
// 								//请求地址
// 								url : "rtmp://127.0.0.1:1935/live",
// 								//数据，json字符串
// 								// data : JSON.stringify(list),
// 								//请求成功
// 								success : function(result) {
// 									alert('成功：'+result);
// 								},
// 								//请求失败，包含具体的错误信息
// 								error : function(e){
// 									alert('失败状态：'+e.status);
// 									alert('失败原因：'+e.responseText);
// 								}
// 							});
						}
						
						//异常的回调函数
						function error(error){
							alert("访问用户媒体设备失败：",error.name,error.message)
						    console.log("访问用户媒体设备失败：",error.name,error.message);
						}
						if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia|| navigator.msGetUserMedia){
							   
						    //调用用户媒体设备，访问摄像头
						    getUserMedia({video:{facingMode: 'user'}},success,error);
						} else {
						    alert("你的浏览器不支持访问用户媒体设备");
						}

             			
                
            });
		</script>
	</body>
</html>






















